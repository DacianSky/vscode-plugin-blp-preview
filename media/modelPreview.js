(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var e="undefined"!=typeof Float32Array?Float32Array:Array;function a(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t){var e=t[0],a=t[1],n=t[2];return Math.hypot(e,a,n)}function s(t,a,n){var s=new e(3);return s[0]=t,s[1]=a,s[2]=n,s}function i(t,e,a,n){return t[0]=e,t[1]=a,t[2]=n,t}function o(t,e,a){return t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t}function r(t,e,a){return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function h(t,e){var a=e[0],n=e[1],s=e[2],i=a*a+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function l(t,e,a){var n=e[0],s=e[1],i=e[2],o=a[3]*n+a[7]*s+a[11]*i+a[15];return o=o||1,t[0]=(a[0]*n+a[4]*s+a[8]*i+a[12])/o,t[1]=(a[1]*n+a[5]*s+a[9]*i+a[13])/o,t[2]=(a[2]*n+a[6]*s+a[10]*i+a[14])/o,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function c(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}a(),function(){var t;t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var d;a(),s(1,0,0),s(0,1,0),c(),c(),d=new e(9),e!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1;const u=a(),v=a(),m=c(),p=new Float32Array(1);function f(t,e){let a=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(a*a+n*n)}class g{constructor(t,e={}){this.scene=t,this.canvas=t.viewer.canvas,this.camera=t.camera,this.moveSpeed=e.moveSpeed||2,this.rotationSpeed=e.rotationSpeed||Math.PI/180,this.zoomFactor=e.zoomFactor||.1,this.horizontalAngle=e.horizontalAngle||Math.PI/2,this.verticalAngle=e.verticalAngle||Math.PI/4,this.distance=e.distance||500,this.position=e.position||a(),this.target=e.target||a(),this.twist=e.twist||0,this.mouse={buttons:[!1,!1,!1],x:0,y:0,x2:0,y2:0},this.touchMode=-1,this.touches=[],this.instance=null,this.onManualChange=e.onManualChange||null,this.fov=e.fov||Math.PI/4,this.nearClipPlane=e.nearClipPlane||1,this.farClipPlane=e.farClipPlane||2e5,this.update(),window.addEventListener("resize",(t=>this.onResize())),setTimeout((()=>this.onResize()),0),this.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),this.canvas.addEventListener("selectstart",(t=>t.preventDefault())),this.canvas.addEventListener("mousedown",(t=>{t.preventDefault(),this.mouse.buttons[t.button]=!0})),document.addEventListener("mouseup",(t=>{t.preventDefault(),this.mouse.buttons[t.button]=!1})),window.addEventListener("mousemove",(t=>{this.mouse.x2=this.mouse.x,this.mouse.y2=this.mouse.y,this.mouse.x=t.clientX,this.mouse.y=t.clientY;let e=this.mouse.x-this.mouse.x2,a=this.mouse.y-this.mouse.y2;this.mouse.buttons[0]&&this.rotate(e,a),this.mouse.buttons[2]&&this.move(-e,a)})),this.canvas.addEventListener("wheel",(t=>{t.preventDefault();let e=t.deltaY;1===t.deltaMode&&(e=e/3*100),this.zoom(e/100)})),this.canvas.addEventListener("touchstart",(t=>{t.preventDefault();let e=t.targetTouches;1===e.length?this.touchMode=0:2==e.length?this.touchMode=1:this.touchMode=-1,this.touches.length=0,this.touches.push(...e)})),this.canvas.addEventListener("touchend",(t=>{t.preventDefault(),this.touchMode=-1})),this.canvas.addEventListener("touchcancel",(t=>{t.preventDefault(),this.touchMode=-1})),this.canvas.addEventListener("touchmove",(t=>{t.preventDefault();let e=t.targetTouches;if(0===this.touchMode){let t=this.touches[0],a=e[0],n=a.clientX-t.clientX,s=a.clientY-t.clientY;this.rotate(n,s)}else if(1===this.touchMode){let t=f(this.touches[0],this.touches[1]),a=f(e[0],e[1]);this.zoom((t-a)/50)}this.touches.length=0,this.touches.push(...e)}))}update(){if(this.instance){let t=this.instance,e=t.model.cameras[0];e.getTranslation(u,t.sequence,t.frame,t.counter),o(u,u,e.position),e.getTargetTranslation(v,t.sequence,t.frame,t.counter),o(v,v,e.targetPosition),e.getRotation(p,t.sequence,t.frame,t.counter),this.twist=p[0],l(u,u,t.worldMatrix),l(v,v,t.worldMatrix),this.moveToAndFace(u,v)}else this.updateInternalCamera()}move(t,e){let a=this.camera.directionX,n=this.camera.directionY,s=this.canvas.width,l=this.canvas.height,c=s/l,d=t/s*this.distance*c,v=e/l*this.distance;o(this.target,this.target,r(u,h(u,i(u,a[0],a[1],0)),d)),o(this.target,this.target,r(u,h(u,i(u,n[0],n[1],0)),v)),this.manualChange()}rotate(t,e){this.horizontalAngle-=t*this.rotationSpeed,this.verticalAngle-=e*this.rotationSpeed,this.manualChange()}zoom(t){this.distance=Math.max(1,this.distance*(1+t*this.zoomFactor)),this.manualChange()}manualChange(){this.updateInternalCamera(),this.instance&&(this.instance=null,this.onManualChange&&this.onManualChange())}onResize(){let t=Math.max(this.canvas.clientWidth,1),e=Math.max(this.canvas.clientHeight,1);this.canvas.width=t,this.canvas.height=e,this.scene.viewport[2]=t,this.scene.viewport[3]=e,this.camera.perspective(this.fov,t/e,this.nearClipPlane,this.farClipPlane)}moveToAndFace(t,e){!function(t,e,a){t[0]=e[0]-a[0],t[1]=e[1]-a[1],t[2]=e[2]-a[2]}(u,t,e);let a=n(u),s=Math.atan2(u[1],u[0]),i=Math.acos(u[2]/a);!function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}(this.target,e),this.verticalAngle=i,this.horizontalAngle=s+Math.PI/2,this.distance=a,this.updateInternalCamera()}updateInternalCamera(){this.verticalAngle=Math.min(Math.max(.01,this.verticalAngle),Math.PI-.01),function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(m),function(t,e,a){a*=.5;var n=e[0],s=e[1],i=e[2],o=e[3],r=Math.sin(a),h=Math.cos(a);t[0]=n*h+s*r,t[1]=s*h-n*r,t[2]=i*h+o*r,t[3]=o*h-i*r}(m,m,this.horizontalAngle),function(t,e,a){a*=.5;var n=e[0],s=e[1],i=e[2],o=e[3],r=Math.sin(a),h=Math.cos(a);t[0]=n*h+o*r,t[1]=s*h+i*r,t[2]=i*h-s*r,t[3]=o*h-n*r}(m,m,this.verticalAngle),i(this.position,0,0,1),function(t,e,a){var n=a[0],s=a[1],i=a[2],o=a[3],r=e[0],h=e[1],l=e[2],c=s*l-i*h,d=i*r-n*l,u=n*h-s*r,v=s*u-i*d,m=i*c-n*u,p=n*d-s*c,f=2*o;c*=f,d*=f,u*=f,v*=2,m*=2,p*=2,t[0]=r+c+v,t[1]=h+d+m,t[2]=l+u+p}(this.position,this.position,m),r(this.position,this.position,this.distance),o(this.position,this.position,this.target);let t=this.twist-Math.PI/2;i(u,0,-Math.cos(t),-Math.sin(t)),this.camera.moveToAndFace(this.position,this.target,u)}applyInstanceCamera(t){this.instance=t,this.fov=t.model.cameras[0].fieldOfView,this.onResize(),this.update()}}const M=ModelViewer.default.viewer.handlers,w=ModelViewer.default.common.glMatrix;let y=null;w.vec3,w.quat;const A=acquireVsCodeApi();let x=document.getElementById("canvas");x.width=800,x.height=600;let C=new ModelViewer.default.viewer.ModelViewer(x),S=C.addScene();!function(t,e={}){new g(t,e)}(S),C.on("loadstart",(t=>console.log(t))),C.on("load",(t=>console.log("load",t))),C.on("loadend",(t=>console.log("loadend",t))),C.on("error",(t=>console.log("error",t))),C.addHandler(M.mdx),C.addHandler(M.blp),C.addHandler(M.dds);const P={};function b(t){if(console.info(t),t.endsWith(".mdx"))return new Promise((t=>{t(new M.mdx.resource(y,{viewer:C,pathSolver:b}))}));if(t.endsWith(".blp")){const e={};return e.promise=new Promise((a=>{e.resolve=a,A.postMessage({type:"load-blp",data:t})})),P[t]=e,e.promise}return"resources/"+t}!function t(){requestAnimationFrame(t),C.updateAndRender()}(),A.postMessage({type:"load-mdx"});let I=null;window.addEventListener("message",(async t=>{switch(t.data.type){case"mdxData":y=t.data.data,C.load("test.mdx",b).then((t=>{if(t){!function(t){console.info(t);let e=t.sequences.map((t=>t.name));0===e.length&&(e=["None"]),console.info(e),document.getElementById("select").innerHTML=e.map(((t,e)=>{return`<option value="${e}">${a=t,a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</option>`;var a})).join("")}(t),function(){let t=document.getElementById("select");t.addEventListener("input",(()=>{I.setSequence(parseInt(t.value,10))}))}();let e=t.addInstance();I=e,e.setScene(S),e.setSequence(0),e.setSequenceLoopMode(2),e.move([0,0,0])}}));break;case"blpData":if(P[t.data.source])try{let e=C.detectFormat(t.data.data);if(e)return void P[t.data.source].resolve(new e.resource(t.data.data,{viewer:C,pathSolver:b}));t.data.ext&&"dds"===t.data.ext?P[t.data.source].resolve(new M.dds.resource(t.data.data,{viewer:C,pathSolver:b})):P[t.data.source].resolve(new M.blp.resource(t.data.data,{viewer:C,pathSolver:b}))}catch(e){console.error(e,t.data.data)}}})),module.exports=t})();